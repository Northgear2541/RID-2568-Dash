<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Dashboard สถานะงาน</title>
  <!-- Font Thai -->
  <link href="https://fonts.googleapis.com/css2?family=Sarabun&display=swap" rel="stylesheet">
  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background: #f0f0f0;
      padding: 20px;
    }
    h2 {
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    .status-รอตรวจสอบ { background-color: #FFF3CD; }
    .status-ตรวจสอบผ่าน { background-color: #D4EDDA; }
    .status-ตรวจสอบไม่ผ่าน { background-color: #F8D7DA; }
    .status-วางบิล { background-color: #E0E0E0; }
    .status-จ่ายเงิน { background-color: #D1ECF1; }
    .status-อยู่ระหว่างตรวจ { background-color: #FFE0B2; }
    .status-อนุมัติจัดพิมพ์ { background-color: #C8E6C9; }
    .status-ตรวจติดตามผ่าน { background-color: #B2DFDB; }
    .status-ตรวจติดตามไม่ผ่าน { background-color: #FFCDD2; }
    .status-ตรวจประเมินผ่าน { background-color: #C5E1A5; }
    .status-ตรวจประเมินไม่ผ่าน { background-color: #EF9A9A; }
    .status-ปิดโครงการ { background-color: #BDBDBD; }
  </style>
</head>
<body>

  <h2>Dashboard สถานะงาน</h2>

  <table id="statusTable" class="display nowrap" style="width:100%">
    <thead>
      <tr>
        <th>ลำดับ (A)</th>
        <th>ชื่องาน (C)</th>
        <th>ผู้รับผิดชอบ (D)</th>
        <th>สถานะงาน (E)</th>
      </tr>
    </thead>
    <tbody>
      <!-- จะถูกเติมข้อมูลโดย JS -->
    </tbody>
  </table>

  <!-- jQuery + DataTables -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRvcrOwNXXon7ub2437NZh70H6rkwxqBeS_x1QHJtzFHiS3EJ9Qk9ClY2p6GLzy2kNanEzK_MIyJW0T/pub?gid=1224553793&single=true&output=csv";

    fetch(csvUrl)
      .then(res => res.text())
      .then(data => {
        const rows = data.split("\n").slice(1); // ข้าม header
        const tbody = document.querySelector("#statusTable tbody");

        rows.forEach(row => {
          const cols = row.split(",");
          const colA = cols[0]?.trim();
          const colC = cols[2]?.trim();
          const colD = cols[3]?.trim();
          const colE = cols[4]?.trim();

          if (colA && colC && colD && colE) {
            const tr = document.createElement("tr");
            tr.className = "status-" + colE;
            tr.innerHTML = `
              <td>${colA}</td>
              <td>${colC}</td>
              <td>${colD}</td>
              <td>${colE}</td>
            `;
            tbody.appendChild(tr);
          }
        });

        // โหลด DataTable หลังจากข้อมูลมาแล้ว
        $('#statusTable').DataTable({
          dom: 'Bfrtip',
          buttons: ['excelHtml5'],
          language: {
            search: "ค้นหา:",
            lengthMenu: "แสดง _MENU_ แถวต่อหน้า",
            info: "แสดง _START_ ถึง _END_ จากทั้งหมด _TOTAL_ แถว",
            infoEmpty: "ไม่มีข้อมูลให้แสดง",
            zeroRecords: "ไม่พบข้อมูลที่ค้นหา",
            paginate: {
              first: "หน้าแรก",
              last: "หน้าสุดท้าย",
              next: "ถัดไป",
              previous: "ก่อนหน้า"
            }
          }
        });
      });
  </script>

</body>
</html>
